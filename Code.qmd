--- 
title: "Stat 210 Project" 
author: "Sofia Silvosa" 
format: pdf 
---

# Introduction 




```{r read-data, message = F, warning = F}
library(tidyverse)
library(ggfortify)
library(viridis)
library(tidymodels)
library(ggplot2)
library(car)
library(leaps)
library(broom)
library(knitr)
library(dplyr)
library(MASS)
library(lme4)
library(glmnet)
library(readr)
library(readr)
movies <- read_csv("movies.csv")

```

# Background and Significance:



There has been recent discussion on adequation representation in film.
The movie industry has changed a lot in the past couple of decades due to
increased advocady for diversity and inclusion. Over th years, we have
seen more BIPOC representation in entertainement as well as gender identity
and LGBTQ+ representation. Many in the film industry have also championed the
increased representaion of women in film. For a while Hollywood procudced 
very little movies with female protagonists; let alone movies with apprpropirayte 
representation of women
(Goodman, 2017). But there has been recent progress in the recent years with 
an impressive increase in female lead movies in the 2010s; not only that but
these films have achived monetary sucesss. In 2016 with, 29 percent of 
protagonists in the top 100 box-office hits were women (Goodman, 2017)

However, merely having female prtagaonsits does not paint the full picture if
whether a movie actually does a good job in female representation. 
Many have used the so-called Bechdel test to make this judgement.
The Bechdel test is

# Data:





# Research Question & Hypothesis

Does the decade a movie was released predict whether it passes 
the bechdel test (logistic regression)
will this change if we look at the variable in a multinomial fashion?

Does passing the bechdel test predict how much a movie is going to
make while controllung for other important variables?



#Exploratory Data Analysis


```{r how-many-movies-passed-test-across-decades, message = F, warning = F}



# rename columns


colnames(movies)[which(names(movies) == "domgross_2013$")] <- "dom_Gross2013"
colnames(movies)[which(names(movies) == "budget_2013$")] <- "budget_Gross2013"
colnames(movies)[which(names(movies) == "intgross_2013$")] <- "int_Gross2013"

#remove NAs


movies1 <- movies[!(movies$dom_Gross2013=="#N/A" | movies$budget_Gross2013 =="#N/A"),]

movies1$ dom_Gross2013<- as.numeric(movies1$dom_Gross2013)
movies1$ budget_Gross2013 <- as.numeric(movies1$budget_Gross2013)
movies1$ int_Gross2013<- as.numeric(movies1$int_Gross2013)

#change units to a million

movies2 <- movies1 %>% 
  mutate(dom_gross_mil = dom_Gross2013 /1000000) %>% 
  mutate(int_gross_mil = int_Gross2013 /1000000) %>% 
    mutate(  budget_mil = budget_Gross2013 /1000000)


movies_decades <- movies2 %>% 
  mutate(decade= case_when(year < 1980 ~ '1970s' ,
                         1980<= year & 1990 > year ~ '1980s' ,
                         1990<= year & 2000 > year ~ '1990s' ,
                         2000<= year & 2010 > year ~ '2000s ',
                       2010 <= year ~ '2010s ' ))  
  
  ggplot(data= movies_decades, mapping= aes(x=decade, fill=binary)) +
  geom_bar(position = "fill")


movies_decades %>% 
  group_by(decade) %>% 
  summarise(number_of_movies =n())

movies_decades %>%
  group_by(decade) %>%
  summarize(passed_movies = sum(binary == 'PASS'))


proportion_70s = 14/ 54
proportion_80s = 36 / 125
proportion_90s = 147/ 337
proportion_2000s = 409/ 840
proportion_2010s = 197/ 438



```
We can see above that there is general upward trend across
the decades with an increased percentage of movies that pass the 
Bechdel test. We see, specifically that the movies from our data set
that premiered in the 2000s, about 48% of the films passed the Bechdel test.
The 2010s performed in a similar fashion, with 45% of the films released
passing the Bechdel test (it is important to note however that this
data set only includes movies till 2013, thus it does not paint the
full picture of female representation in film.) The decade with'the lowest
percentage of movies that passed the Bechdel test was teh 1970s, with
only 25% passing.



```{r how-many-movies-passed-test-across-decades, message = F, warning = F}


  
  ggplot(data= movies_decades, mapping= aes(x=decade, fill=clean_test)) +
  geom_bar()





```

clean_ test: categories

men= women only about men
not talk= women do not talk to each other
ok= passed
no women= no women in the film
dubious = unclear


```{r how-many-movies-passed-test-across-decades, message = F, warning = F}


  
  ggplot(data= movies_decades, mapping= aes(x= binary, y= dom_Gross2013)) +
  geom_boxplot()




```


 ^^^ this looks bad but I do not think this difference is significant (lots of factors we are not controlling for)
 
 
 

```{r how-many-movies-passed-test-across-decades, message = F, warning = F}





ggplot(data = movies_decades, mapping = aes(x = year, y = dom_Gross2013 )) +
  geom_point() +
  facet_grid(. ~ binary)



```
# Research Question 2: *Does the time period a movie came out in predict whether a movies fails or passes the Bechdel test?*



```{r make-variable-binary, message = F, warning = F}

movies1_0 <- movies_decades %>% 
 mutate(passfail= ifelse(binary =='PASS', 1, 0))




```






```{r log, message = F, warning = F}

 
  




m2 <- glm(passfail ~ decade,
          data = movies1_0,
          family = "binomial")
summary(m2)


```


```{r log, message = F, warning = F}

 
  

m2 <- glm(passfail ~ decade + budget_Gross2013 +dom_Gross2013 + int_Gross2013,
          data = movies1_0,
          family = "binomial")
summary(m2)


```

# lets run this model but multinomially


```{r multinomial, message = F, warning = F}

 
library(nnet)


movie_dummy <- movies1_0 %>% 
group_by(clean_test) %>% 
mutate(ok_clean = case_when(clean_test=='ok' ~'Aok',
                         clean_test=='men' ~'men',
                         clean_test=='dubious'~'dubious',
                     clean_test== 'notalk' ~ 'notalk',
                     clean_test== 'nowomen' ~ 'nowomen'))


  

m2 <- multinom(ok_clean ~ decade + budget_Gross2013 +dom_Gross2013 + int_Gross2013,
          data = movie_dummy)
summary(m2) 



```



While holding all the over variables in our model constant, for every one year increase in the year a given was released, the odds of whether the given film is 

That is, in comparing two individuals with the same sex, where one is one year older than the other, we predict that that individual has approximately 0.998 times the odds of survival compared to the younger individual



```{r LASSO, message = F, warning = F}

 
  y <- movies1_0$passfail
x <- model.matrix(passfail ~ decade + budget_Gross2013 +dom_Gross2013 + int_Gross2013 ,
                  data = movies1_0)
library(glmnet) # (has LASSO-related functions here)
m_lasso_cv <- cv.glmnet(x, y, alpha = 1)

best_lambda <- m_lasso_cv$lambda.min
best_lambda

m_best <- glmnet(x, y, alpha = 1, lambda = best_lambda)
m_best$beta

plot(m_lasso_cv)

```


```{r LASSO, message = F, warning = F}

###subset 
 
library(leaps)
m_all <- regsubsets(passfail ~ decade + budget_Gross2013 +dom_Gross2013 + int_Gross2013 ,
                  data = movies1_0, 
                  nbest = 1, nvmax =9)




summary(m_all)

summary(m_all)$cp
#summary(m_all)$rsq
summary(m_all)$bic

```

Through this method we are able to see that our test is pretty good since the more variables we put in the better our mode is as shown by bic and cp.



# Research Question 2: *does passing or failing the Bechdel test predict whether a film's financial success?*



Our Model is as follows for each Bechdel test result i: 


$Domestic Gross =\beta_0 + \beta_1(Budget)_i + \beta_2(Year)_i + \beta_2(Year) + \beta_3I(BinaryResult)  + \epsilon_i$ 
 
We will run a hypothesis at the $a$ = 0.05 level.


Nulll hypothesis: 

$H_0: \beta_3 = 0$

There is no difference between movies who pass the Bechdel test and 
those who fail it in 
terms of generated domestic gross across the 1970-2013 period.


Alternative Hypothesis:

$H_1: \beta_3  \neq \ 0$ 

There is a difference between movies who pass the Bechdel test and
those who fail it in 
terms of generated domestic gross across the 1970-2013 period.


```{r how-many-movies-passed-test-across-decades, message = F, warning = F}



m1 <- lm(dom_Gross2013 ~ binary + budget_Gross2013 + year  , data = movies_decades)
summary(m1) 



```
Results: Our formal hypothesis test reveals that we have a t-statistic of -2.590
with 1772 degrees of freedom. The distribution of the test 
statistic under the null hypothesis
in this case will be a t distribution.

In this case we fail reject the null hypothesis because our p-value of 0.608 
is greater than our established statistically significant level of 0.05.
In other words, in this model-- in which we are holding all other
variables constant-- we do not have sufficient evidence to demonstrate a 
a significant difference between movies that pass the Bechdel test and those
that fail in 
terms of domestic gross.



##Sources

https://www.nytimes.com/2017/02/21/movies/women-protagonists-movies-2016.html
https://www.tandfonline.com/doi/pdf/10.1080/14680777.2016.1234239?needAccess=true

https://fivethirtyeight.com/features/the-dollar-and-cents-case-against-hollywoods-exclusion-of-women/


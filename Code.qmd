--- 
title: "Stat 210 Project" 
author: "Sofia Silvosa" 
format: pdf 
---

# Introduction 




```{r read-data, message = F, warning = F, echo=FALSE}
library(tidyverse)
library(ggfortify)
library(viridis)
library(tidymodels)
library(ggplot2)
library(car)
library(leaps)
library(broom)
library(knitr)
library(dplyr)
library(MASS)
library(lme4)
library(glmnet)
library(readr)
library(readr)
movies <- read_csv("movies.csv")

```

*Background and Significance:*


There has been recent discussion on adequate female representation in film.
Many in the film industry have recently praised the
increased representation of women in film. For a while Hollywood produced
very little movies with female protagonists; let alone movies with appropriate 
representation of women
(Goodman, 2017). But there has been recent progress in the recent years with 
an impressive increase in female lead movies in the 2010s; not only that but
these films have achieved monetary success. In 2016 with, 29 percent of 
protagonists in the top 100 box-office hits were women (Goodman, 2017)

However, merely having female protagonists does not paint the full picture if
whether a movie actually does a good job in female representation. 
Many have used the so-called Bechdel test to make this judgement. This test
was developed by Allison Bechdel in 1985 and has recently become a digital
sensation (O'Meara).

The Bechdel test is a simple test which deems that a movie has adequate 
female character in their film if it passes the following three criteria:
(1) it has to have at least two women in it, who (2) who talk to each other, 
about (3) something besides a man (https://bechdeltest.com/) .


Many have argued that there has been significant increase of female 
representation throughout the decades thanks to increased diversity 
initiatives and more women at the helm of the film industry 
(UCLA-Hollywood-Diversity-Report-2022-Film). If this the case, then
we would expect more recent films, specially those of the 2000s and 2010s, to
have a greater amount of films that pass the Bechdel test. 



# Research Question & Hypothesis

We are interested in evaluating what variables are important in
predicting whether a movie form this specific data set passes or fails
the Bechdel test. We are more so interested in how time period plays 
a role in predictihng whether a movie passes or fails the Bechdel test.

In other words, Does the decade a movie was released predict whether it passes 
the Bechdel test while controlling for other pivotal variables in our model?

As shiwn by recent news and media, more modern movies seem to have more
increased rprpensstaion of women in their films. Thus, we predict that 
the time period in whcih a movie was released will play a significnat role
in whether the movie fails or passes the Bechdel test. More specicially,
we predict that movies released in the 200's and 2010's have a greater
percentage of movies that pass the Bechdel rather than those that came 
out in the 20th century represented in our data set.






*Data*

To explore our reserch quetsion, we will be using a dataset used in the
FiveThirtyEight story titled “The Dollar-And-Cents Case Against Hollywood’s
Exclusion of Women”. The dataset includes observations from 1794 films 
that were released between 1970-2013. The data set includes huge box office
hit films including "Die Hard: With a Vengeance" and  David Fincher's "Se7en."
The data set includes information detailing the title of the film, the year it
was released, its domestic gross, budget and international gross (both 
accounting for inflation and without). Furthermore, for our urposes, 
the data set also includes two important columns regarding whether the
movie passed or failed the Bechdel test. The column "binary" 
specifically states whether teh movie passed or failed the bechdel test in a 
binary fashion. The column "clean_test" goes a bit more in detail, regarding
how the film failed the bechdel test or if it was unclear whether the movie 
passed or not. The clean test variable has five levels: ok (Passed), no women
(No women in the film), dubious (unclear result), no talk(women did not
talk to each other), and men (women only talked about men.)

We created new variables for the purposes of our analysis. For starters,
we created a decades variable that detailed which decade the given film
was released in. The variable ended up having 5 different levels: 1970s,
1980s, 1990s, 2000s and 2010s. We also created a new variable titled passfail
which is essentially the same as our binary variable but instead uses dummy
values to illustrated whether the movies passed (passfail=1) pr failed 
(passdfail=0) the Bechdel test.

We excluded 18 observations from our final analysis. These observations had 
no values for their total domestic gross and total budget. These 
are variables of interest that important variables that we want to control for
thus the movies that did not have the values for these variables were removed.
Since we still had 1776 left in our data set, our statustical analyses will
not be greatly affected since we are still working with a large data set.



#Exploratory Data Analysis



```{r how-many-movies-passed-test-across-decades-1, message = F, warning = F, echo= FALSE}



# rename columns


colnames(movies)[which(names(movies) == "domgross_2013$")] <- "dom_Gross2013"
colnames(movies)[which(names(movies) == "budget_2013$")] <- "budget_Gross2013"
colnames(movies)[which(names(movies) == "intgross_2013$")] <- "int_Gross2013"

#remove NAs


movies1 <- movies[!(movies$dom_Gross2013=="#N/A" | movies$budget_Gross2013 =="#N/A"),]

movies1$ dom_Gross2013<- as.numeric(movies1$dom_Gross2013)
movies1$ budget_Gross2013 <- as.numeric(movies1$budget_Gross2013)
movies1$ int_Gross2013<- as.numeric(movies1$int_Gross2013)

#change units to a million

movies2 <- movies1 %>% 
  mutate(dom_gross_mil = dom_Gross2013 /1000000) %>% 
  mutate(int_gross_mil = int_Gross2013 /1000000) %>% 
    mutate(  budget_mil = budget_Gross2013 /1000000)


movies_decades <- movies2 %>% 
  mutate(decade= case_when(year < 1980 ~ '1970s' ,
                         1980<= year & 1990 > year ~ '1980s' ,
                         1990<= year & 2000 > year ~ '1990s' ,
                         2000<= year & 2010 > year ~ '2000s ',
                       2010 <= year ~ '2010s ' ))  
  
  ggplot(data= movies_decades, mapping= aes(x=decade, fill=binary)) +
  geom_bar(position = "fill") +
labs(title="The % of films that pass the Bechdel Test has increased through time", 
       subtitle = "The 2010s had the largest percentage of movies that passed
     the Bechdel Test",
     y= 'Propportion of Bechdel Test Results', fill= 'Bechdel Test Results',
     x= 'Decade')


movies_decades %>% 
  group_by(decade) %>% 
  summarise(number_of_movies =n())

movies_decades %>%
  group_by(decade) %>%
  summarize(passed_movies = sum(binary == 'PASS'))


proportion_70s = 14/ 54
proportion_80s = 36 / 125
proportion_90s = 147/ 337
proportion_2000s = 409/ 840
proportion_2010s = 197/ 438



```
We can see above that there is general upward trend across
the decades with an increased percentage of movies that pass the 
Bechdel test. We see, specifically that the movies from our data set
that premiered in the 2000s, about 48% of the films passed the Bechdel test.
The 2010s performed in a similar fashion, with 45% of the films released
passing the Bechdel test (it is important to note however that this
data set only includes movies till 2013, thus it does not paint the
full picture of female representation in film.) The decade with'the lowest
percentage of movies that passed the Bechdel test was teh 1970s, with
only 25% passing.



```{r how-many-movies-passed-test-across-decades2, message = F, warning = F, echo= FALSE}


  
  ggplot(data= movies_decades, mapping= aes(x=decade, fill=clean_test)) +
  geom_bar()





```



```{r how-many-movies-passed-test-across-decades22, message = F, warning = F, echo= FALSE}


  
  ggplot(data= movies_decades, mapping= aes(x= binary, y= dom_Gross2013)) +
  geom_boxplot()




```


#Methodolody




First, we ran a logistic regression model to see if decade alone can
predict whether a movie passes or fails the Bechdel test. We chose to run
a logistic regression model and use the binary variable detailing whether 
the movie passed or did not pass teh Bechdel tets. We chose to use the binary 
version detailing whether given dilm's performance on the Bechdel test rather
than our clean_test variable. If we ran a logistic model with the clean_test
as our outcome variable, we would have to use a multinomial regression model
to test out our research question. A multinomial regression model would not
made sense in this context the  independence of irrelevant alternatives
assumption would have been violated. This assumption assumes that, in a
multinomial logistic
regression model, the relative odds of choosing one option over another
should not be influenced
by the inclusion or exclusion of an additional option.
This assumption does not 
apply in this case. This does not make sense since the inclusion or exclusion 
of a Bechdel test failing category could have an effect on our final analysis. 
For example, if a given film with plentiful female representation that was 
released in 2013 (which according to our hypothesis means it has a greater
chance of passing the Bechdel test) was included our model but the only
two categories taken accounted for whether "notalk" and "dubious," 
our model would predict it was it fit the dubious category. However, 
if the "ok" was included in teh mix, tsi woulc change our predictive probablity.. 






# Research Question 1: *Does the time period a movie came out in predict whether a movies fails or passes the Bechdel test? Furthermore, are there another important predictors that can help us predict whether a movies passes or fails the Bechdel test?*



```{r make-variable-binary, message = F, warning = F, echo=FALSE}

movies1_0 <- movies_decades %>% 
 mutate(passfail= ifelse(binary =='PASS', 1, 0))




```




First, we ran a logistic regression model to see if decade alone can
predict whether a movie passes or fails the bechdel test. 






```{r LASSO, message = F, warning = F, echo= FALSE}

 
  y <- movies1_0$passfail
x <- model.matrix(passfail ~ decade + budget_Gross2013 +dom_Gross2013 + int_Gross2013 ,
                  data = movies1_0)
library(glmnet) # (has LASSO-related functions here)
m_lasso_cv <- cv.glmnet(x, y, alpha = 1)

best_lambda <- m_lasso_cv$lambda.min
best_lambda

m_best <- glmnet(x, y, alpha = 1, lambda = best_lambda)
m_best$beta

plot(m_lasso_cv)

```


```{r LASSO2, message = F, warning = F}

###subset 
 
library(leaps)
m_all <- regsubsets(passfail ~ decade + budget_Gross2013 +dom_Gross2013 + int_Gross2013 ,
                  data = movies1_0, 
                  nbest = 1, nvmax =9)




summary(m_all)

summary(m_all)$cp
#summary(m_all)$rsq
summary(m_all)$bic

```

Through this method we are able to see that our test is pretty good since the more variables we put in the better our mode is as shown by bic and cp.





```{r log-predict-passfail2323, message = F, warning = F}

 
  

m2 <- glm(passfail ~ decade + budget_Gross2013 +dom_Gross2013 + int_Gross2013,
          data = movies1_0,
          family = "binomial")
summary(m2)


exp(8.648e-01)


```

While holding all other variables in our model constant, according to our
model, the odds of a movie from the 2000s to pass the Bechdel is estimated
to be  2.374531 times the odds of a movie from the 1970's to pass the test.

Furthermore, 


```{r how-many-movies2-passed-test-across-decades, message = F, warning = F}


m2_aug <- augment(m2)
m2_aug <- m2_aug %>%
mutate(prob = exp(.fitted)/(1 + exp(.fitted)), pred_leg = ifelse(prob >
0.5,
'Pass',
'Fail')) 
  
table(m2_aug$pred_leg, m2_aug$passfail)

m2_aug %>% 
  roc_auc(
    truth = as.factor(passfail),
    prob, 
    event_level = "second"
  )


m2_aug %>% 
  roc_curve(
    truth = as.factor(passfail),
    prob, 
    event_level = "second"
  ) %>% 
  autoplot()



```
The AUC (area under the curve) can be used to assess how well we are predicting, and summarizes the entire ROC curve. An AUC of 0.5 implies that the model is no better than a coin flip - an AUC of 1 implies a perfect fit.



```{r log-predict-passfail3, message = F, warning = F}

 
  library(Stat2Data)
emplogitplot1(passfail ~ dom_Gross2013,
              data = movies1_0,
              ngroups = 10)


# nice
```


```{r log-predict-passfailll, message = F, warning = F}

 
  library(Stat2Data)
emplogitplot1(passfail ~ budget_Gross2013,
              data = movies1_0,
              ngroups = 10)


# nice
```




# Research Question 2: *does passing or failing the Bechdel test predict whether a film's financial success?*



Our Model is as follows for each Bechdel test result i: 


$Domestic Gross =\beta_0 + \beta_1(Budget)_i + \beta_2(Year)_i + \beta_2(Year) + \beta_3I(BinaryResult)  + \epsilon_i$ 
 
We will run a hypothesis at the $a$ = 0.05 level.


Nulll hypothesis: 

$H_0: \beta_3 = 0$

There is no difference between movies who pass the Bechdel test and 
those who fail it in 
terms of generated domestic gross across the 1970-2013 period.


Alternative Hypothesis:

$H_1: \beta_3  \neq \ 0$ 

There is a difference between movies who pass the Bechdel test and
those who fail it in 
terms of generated domestic gross across the 1970-2013 period.


```{r how-many-movies2333-passed-test-across-decades, message = F, warning = F}



m1 <- lm(dom_Gross2013 ~ binary + budget_Gross2013 + year  , data = movies_decades)
summary(m1) 



```
Results: Our formal hypothesis test reveals that we have a t-statistic of -2.590
with 1772 degrees of freedom. The distribution of the test 
statistic under the null hypothesis
in this case will be a t distribution.

In this case we fail reject the null hypothesis because our p-value of 0.608 
is greater than our established statistically significant level of 0.05.
In other words, in this model-- in which we are holding all other
variables constant-- we do not have sufficient evidence to demonstrate a 
a significant difference between movies that pass the Bechdel test and those
that fail in 
terms of domestic gross.



##Sources

https://socialsciences.ucla.edu/wp-content/uploads/2022/03/UCLA-Hollywood-Diversity-Report-2022-Film-3-24-2022.pdf

https://www.nytimes.com/2017/02/21/movies/women-protagonists-movies-2016.html
https://www.tandfonline.com/doi/pdf/10.1080/14680777.2016.1234239?needAccess=true

https://bechdeltest.com/

https://fivethirtyeight.com/features/the-dollar-and-cents-case-against-hollywoods-exclusion-of-women/


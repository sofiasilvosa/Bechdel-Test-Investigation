--- 
title: "Stat 210 Project" 
author: "Sofia Silvosa" 
format: pdf 
---

# Introduction 



```{r read-data, message = F, warning = F, echo=FALSE}
library(tidyverse)
library(ggfortify)
library(viridis)
library(tidymodels)
library(ggplot2)
library(broom.mixed)
library(car)
library(leaps)
library(broom)
library(knitr)
library(kableExtra)
library(dplyr)
library(MASS)
library(lme4)
library(glmnet)
library(readr)
library(readr)
movies <- read_csv("movies.csv")

```

*Background and Significance:*


There has been recent discussion on adequate female representation in film.
Many in the film industry have recently praised the
increased representation of women in film (Nolfi,2017). For a while Hollywood produced
very little movies with female protagonists; let alone movies with appropriate 
representation of women
(Goodman, 2017). But there has been recent progress in the recent years with 
an impressive increase in female lead movies in the 2010s; not only that but
these films have achieved monetary success. In 2016 with, 29 percent of 
protagonists in the top 100 box-office hits were women (Goodman, 2017) However, merely having female protagonists does not paint the full picture if whether a movie actually does a good job in female representation.  Many have used the so-called Bechdel test to make this judgement. This test
was developed by Allison Bechdel in 1985 and has recently become a digital
sensation (Hickey, 2014).The Bechdel test is a simple test which deems that a movie has adequate 
female character in their film if it passes the following three criteria:
(1) it has to have at least two women in it, who (2) who talk to each other, 
about (3) something besides a man (https://bechdeltest.com/) .


Many have argued that there has been significant increase of female 
representation throughout the decades thanks to increased diversity 
initiatives and more women at the helm of the film industry 
(UCLA-Hollywood-Diversity-Report-2022-Film). If this the case, then
we would expect more recent films, specially those of the 2000s and 2010s, to
have a greater amount of films that pass the Bechdel test. 

# Research Question & Hypothesis


We're interested in evaluating what variables are important in
predicting whether a movie passes or fails
the Bechdel test. We are interested specifically if the time period
in which a movie was released predicts whether a movie passes the Bechdel test. In other words, does the decade a movie was released predict whether it passes  the Bechdel test while controlling for other pivotal variables in our model? As shown by recent news and media, more modern movies seem to have more
increased representation of women in their films. Thus, we predict that 
the time period in which a movie was released will play a significant role
in whether the movie fails or passes the Bechdel test. More specially,
we predict that movies released in the 2000's and 2010's have a greater
percentage of movies that pass the Bechdel rather than those that came 
out in the 20th century represented in our data set.

*Data*

To explore our research quetsion, we'll be using a data set used in the
FiveThirtyEight story titled “The Dollar-And-Cents Case Against Hollywood’s
Exclusion of Women” (Hickey, 2014). The data set includes observations from 1794 films 
that were released between 1970-2013.The data set was organized by combining
data from two major sources. One of them came from the BechdelTest.com: a 
website operated by committed moviegoers who analyze films and 
ascertain if they pass the Bechdel test. To provide financial 
information for the chosen films, the FiveThirtyEight team gathered data from the website The-Numbers.com, a leading site for box office and budget data. The finalized *movies.cv* data set includes information
detailing the title of the film, the year it was released, its domestic gross, 
budget and international gross (both accounting for inflation at the time 
of data collection and without). See Data Dictionary for more details.

Furthermore, for our purposes, the data set also includes two important 
columns regarding whether the movie passed or failed the Bechdel test. 
The column "binary" specifically states whether the movie passed or 
failed the Bechdel test in a binary fashion. The column "clean_test" goes a
bit more in detail, regarding
how the film failed the Bechdel test or if it was unclear whether the movie 
passed or not. The clean test variable has five levels: ok (Passed), no women
(No women in the film), dubious (unclear result), no talk(women did not
talk to each other), and men (women only talked about men.)

We created new variables for the purposes of our analysis. For starters,
we created a decades variable that detailed which decade the given film
was released in. The variable ended up having 5 different levels: 1970s,
1980s, 1990s, 2000s and 2010s. We also created a new variable titled passfail
which is essentially the same as our binary variable but instead uses dummy
values to illustrated whether the movies passed (passfail=1) failed 
(passfail=0) the Bechdel test. We excluded 18 observations from our final
analysis. These observations had no values for their total domestic gross 
and total budget. These are variables of interest that important variables that
we want to control for .Since we still had 1776 left in our data set, our statistical analyses will not be greatly affected by the removal of these observations.

#Exploratory Data Analysis
```{r adding-new-variables, message = F, warning = F, echo= FALSE}

# rename columns


colnames(movies)[which(names(movies) == "domgross_2013$")] <- "dom_Gross2013"
colnames(movies)[which(names(movies) == "budget_2013$")] <- "budget_Gross2013"
colnames(movies)[which(names(movies) == "intgross_2013$")] <- "int_Gross2013"

#remove NAs


movies1 <- movies[!(movies$dom_Gross2013=="#N/A" | movies$budget_Gross2013 =="#N/A"),]

movies1$ dom_Gross2013<- as.numeric(movies1$dom_Gross2013)
movies1$ budget_Gross2013 <- as.numeric(movies1$budget_Gross2013)
movies1$ int_Gross2013<- as.numeric(movies1$int_Gross2013)

#change units to a million

movies2 <- movies1 %>% 
  mutate(dom_gross_mil = dom_Gross2013 /1000000) %>% 
  mutate(int_gross_mil = int_Gross2013 /1000000) %>% 
    mutate(  budget_mil = budget_Gross2013 /1000000)


movies_decades <- movies2 %>% 
  mutate(decade= case_when(year < 1980 ~ '1970s' ,
                         1980<= year & 1990 > year ~ '1980s' ,
                         1990<= year & 2000 > year ~ '1990s' ,
                         2000<= year & 2010 > year ~ '2000s ',
                       2010 <= year ~ '2010s ' ))  
  
  ggplot(data= movies_decades, mapping= aes(x=decade, fill=binary)) +
  geom_bar(position = "fill") +
labs(title="The % of films that pass the Bechdel Test has increased through time", 
       subtitle = "The 2010s had the largest percentage of movies that passed
     the Bechdel Test",
     y= 'Propportion of Bechdel Test Results', fill= 'Bechdel Test Results',
     x= 'Decade')


table <- movies_decades %>% 
  group_by(decade) %>% 
  summarise(number_of_movies =n()) %>% 


table2 <- movies_decades %>%
  group_by(decade) %>%
  summarize(passed_movies = sum(binary == 'PASS'))



proportion_70s = 14/ 54
proportion_80s = 36 / 125
proportion_90s = 147/ 337
proportion_2000s = 409/ 840
proportion_2010s = 197/ 438




 



```
We can see above that there is general upward trend across
the decades with an increased percentage of movies that pass the 
Bechdel test. We see, specifically that the movies from our data set
that premiered in the 2000s, about 48% of the films passed the Bechdel test.
The 2010s performed in a similar fashion, with 45% of the films released
passing the Bechdel test (it is important to note however that this
data set only includes movies till 2013, thus it does not paint the
full picture of female representation in film from this decade) The decade with the lowest
percentage of movies that passed the Bechdel test was the 1970s, with
only 25% passing. Below we also see a similar trend when looking years as 
our independent variable and with clean test as our dependent variable,
revealing that films released in the 21st century have a higher percentage
of movies that pass the Bechdel test. Moreover, we also see that no women
talk seems to be the most common reason for a movie to fail the Bechdel test.



```{r graph, message = F, warning = F, echo= FALSE}


  
  ggplot(data= movies_decades, mapping= aes(x= year, fill=clean_test)) +
  geom_bar()+
  labs(title="The % of films that pass the Bechdel Test increases through time",
  subtitle = "No Talk seems to be the most common reason movies fail the Test",
     y= 'Propportion of Bechdel Test Results', fill= 'Bechdel Test Results',
     x= 'Year')




```
#Methodolody

We are interested in running a regression model in order to evaluate
whether the time period a given film was released. Furthermore, we
are interested in using the binary variable "passfail" as our
outcome variable--meaning we will use a logistic regression model. Furthermore,
we believe this is an appropriate model since our data passes the independence
assumption. We can assume that independence is met because our observations
are most likely not correlated with each other. Each of our movie titles
are independent from each other and knowing something about one of our
observations does not reveal anything substantial about another 
observation.

We chose to use the binary 
version detailing whether given film's performance on the Bechdel test rather
than our clean_test variable because we felt that a binary outcome variable 
would generate a simpler model. Furthermore, if we ran a logistic model
with the clean_test as our outcome variable, we would have to use a multinomial 
regression model to test out our research question. A multinomial regression
model would not
make sense in this context the since the independence of irrelevant alternatives
assumption would be violated. This assumption assumes that, in a
multinomial logistic regression model, the relative odds of choosing one option over another
should not be influenced
by the inclusion or exclusion of an additional option. This does not make sense since the inclusion or exclusion 
of a Bechdel test failing category could have an effect on our final analysis. 
For example, if a given film with plentiful female representation that was 
released in 2013 (which according to our hypothesis means it has a greater
chance of passing the Bechdel test) was included our model but the only
two categories taken accounted for whether "notalk" and "dubious," 
our model would predict it was it fit the dubious category. However, 
if the "ok" was included in the mix, this would change our predictive probablity.

Next, we evaluated whether to use the "year" or "decade" variable for
our investigation. On one hand, the year variable is continouus, allowing
us to have greater statistical power. On the other hand, the categorical
"decade" variable applies more to our question of interest and the context
of the data set. The film industry has gone through distinct decade period;
many film research that tackles chronically change discuss the changes
through decades, not years.

To decide which variable to use, we first calculated the RMSE for the variables.

*Model 1:*

$PassFail =\beta_0 + \beta_1(1980s)_i + \beta_2(1990s)_i + \beta_2(2000s) +\beta_3I(2010s)$ 

*Model 2: *


$PassFail =\beta_0 + \beta_1(year)+  \epsilon_ $ 

We calculate the Root Mean Squared Errors for the two models
to see which predictor variable would be the smartest to use:

We found that our first model had a RMSE for our first model was 0.8505231
and for our second model the RMSE was 0.8373541. Thus, we decided to
use the second model for our analysis.

```{r year-or-decade, message = F, warning = F, echo= FALSE}



m11 <- glm(passfail ~ decade, 
          data = movies1_0,
          family = "binomial")
summary(m11)


m22 <- glm(passfail ~ year,
          data = movies1_0,
          family = "binomial")
summary(m22)


m11_aug <- augment(m11); m22_aug <- augment(m22)

rmse(m11_aug, `passfail`, estimate = .fitted)

rmse(m22_aug, `passfail`, estimate = .fitted)

```



However, since we are using a logistic model, we are interested in seeing
if it meets the logistic regression assumptions. And since year is a
continous variable we decided to see if it met our linearity condition.

```{r log-linearity, message = F, warning = F, echo= FALSE}

 
  library(Stat2Data)
emplogitplot1(passfail ~ year,
              data = movies1_0,
              ngroups = 10)


# nice
```

Points are not evenly scattered therefore we have decided that this
is not an appropriate variable to use in our model and instead will use decade.
We could have transformed the variable,  quadratically for example
in order to pass this linearity assumption. However, this will complicate
our interpretation of our model gravely since our outcome variable of
interest would be transformed. Thus, for the purposes of our 
investigation, we will use the decades variable.


We also checked to see if the linearity condition was met for our other
continuous predictors. Only the budget variable passed the linearity
assumption.


```{r lin-assumption, message = F, warning = F, echo=FALSE}

 
  library(Stat2Data)
emplogitplot1(passfail ~ dom_Gross2013,
              data = movies1_0,
              ngroups = 10)


 library(Stat2Data)
emplogitplot1(passfail ~ log(dom_Gross2013),
              data = movies1_0,
              ngroups = 10)

  library(Stat2Data)
emplogitplot1(passfail ~ budget_Gross2013,
              data = movies1_0,
              ngroups = 10)

 library(Stat2Data)
emplogitplot1(passfail ~ (int_Gross2013),
              data = movies1_0,
              ngroups = 10)


# transformed int variable because it violated one of our assymptions
 library(Stat2Data)
emplogitplot1(passfail ~ log(int_Gross2013),
              data = movies1_0,
              ngroups = 10)


 library(Stat2Data)
emplogitplot1(passfail ~ log(int_Gross2013) * dom_Gross2013,
              data = movies1_0,
              ngroups = 10)
 


# nice
```

The linearity condition was met for our predictors dom_Gross2013 and
budget_Gross2013. However, it was not met for our Int_Gross2013 variable.
In order to deal with this violation of our linearity assumption, we applied
a log transformation to our int_Gross variable. Since, this is not 
a particular variable of high interest, our final result interpretations' 
simplicity won't be gravely affected.


Furthermore, to further evaluate which variables to include in our data set,
we ran a LASSO to determine if our variables of interest should be included 
in our model. They were all included thus we decided to include them in our
model. We also decided to introduce an interaction term of intGross2013 *
domGrpss2013 since in real life they depend on each other.


This is our proposed model that we will use to investigate our research question:

 For each deccade the film premiered in $i$,


$p / (1- p)$ = Odds of passing the Bechdel Test


$log(p / (1-p) =\beta_0 + \beta_1(Budget)_i + \beta_2(log(IntGross))_i + \beta_3(log(DomGross)) + \beta_4I(decade1980s)_i  +   \beta_5I(decade1990s)_i  +   \beta_6I(decade2000s)_i     +   \beta_7I(decade2010s)_i   +  \beta_8(log(IntGross))_i * log(DomGross_i) $ 


```{r LASSO, message = F, warning = F, echo= FALSE}

 
  y <- movies1_0$passfail
x <- model.matrix(passfail ~ year + budget_Gross2013 +dom_Gross2013 +
                    log(int_Gross2013) + dom_Gross2013 * int_Gross2013 ,
                  data = movies1_0)
library(glmnet) # (has LASSO-related functions here)
m_lasso_cv <- cv.glmnet(x, y, alpha = 1)

best_lambda <- m_lasso_cv$lambda.min
best_lambda

m_best <- glmnet(x, y, alpha = 1, lambda = best_lambda)
m_best$beta

plot(m_lasso_cv)


#summary(m_all)$cp
#summary(m_all)$rsq
#summary(m_all)$bic

```

## Results



We ran a logistic regression model using the final model discussed 
in the previous section
to see if decade alone can
predict whether a movie passes or fails the Bechdel test. We will then
run a hypothesis test to see if one of our decade categorical predictors
is associated with the score a film gets on the Bechdel test.

Our model is as follows. For each deccade the film premiered in $i$,


$p / (1- p)$ = Odds of passing the Bechdel Test


$log(p / (1-p) =\beta_0 + \beta_1(Budget)_i + \beta_2(log(IntGross))_i + \beta_3(DomGross) + \beta_4I(decade1980s)_i  +   \beta_5I(decade1990s)_i  +   \beta_6I(decade2000s)_i     +   \beta_7I(decade2010s)_i   +  \beta_8(log(IntGross))_i * DomGross_i +     \epsilon_i$ 
 
We will run a hypothesis at the $a$ = 0.05 level.


Null hypothesis: 

$H_0$ : All of our $\beta$ terms for decade ( $\beta_4$, $\beta_5$, $\beta_6$ 
or $\beta_7$ ) are equal to zero.


There is not sufficient evidence to suggest that the decade in 
which a movie
premiered is associated with differential odds of the 
moving passing the Bechdel test, while
controlling for all of the variables listed in the previous section.

Alternative Hypothesis:

$H_1$: At least one of our $\beta$ terms for
decade ( $\beta_4$, $\beta_5$, $\beta_6$ 
or $\beta_7$ ) is not equal to zero.



```{r anova, message = F, warning = F, echo= FALSE}


  
m22 <- glm(passfail ~ decade+ budget_Gross2013 +dom_Gross2013 +
             log(int_Gross2013) + int_Gross2013 * log(dom_Gross2013),
          data = movies1_0,
          family = "binomial")


  
m21 <- glm(passfail ~  budget_Gross2013 +dom_Gross2013 +
             log(int_Gross2013) + int_Gross2013 * log(dom_Gross2013),
          data = movies1_0,
          family = "binomial")

anova(m22, m21, test= 'Chisq') %>% 
  tidy()

qf(p= 0.0002963195, 4 , 1776, lower.tail= FALSE)


```



```{r glm-model, message = F, warning = F, echo=FALSE}


m22 <- glm(passfail ~ decade+ budget_Gross2013 +dom_Gross2013 +
             log(int_Gross2013) + int_Gross2013 * log(dom_Gross2013),
          data = movies1_0,
          family = "binomial")
summary(m22)$coef %>% 
  kable()


exp( 0.8578170)
exp(0.6952480	)


m22 <- glm(passfail ~ decade+ budget_Gross2013 +log(dom_Gross2013) +
             log(int_Gross2013) + log(int_Gross2013) * log(dom_Gross2013),
          data = movies1_0,
          family = "binomial")
summary(m22)




```


This is our model:



$\widehat{logit(PassFail)} = 1.23  -6.323e-09 (Budget)_i +  6.169e-02(log(IntGross))_i + 0.182log((DomGross))  -0.0304507	I(decade1980s)_i  + 0.6285726	I(decade1990s)_i  +   0.8578170I(decade2000s)_i     +   	0.6952480I(decade2010s)_i   -7.744e-03 \beta_8(log(IntGross))_i * DomGross_i $




We will be conducing a z test for this formal hypothesis test. 
The z statistic is 3.274 for the decades2000s variable and the z statistic
is 2.818 for the decades2010s variable.
Z has a standard normal distribution under the null hypothesis in this test. 

We reject the null hypothesis in this case since our p value is less than 
0.05 for two of our decade predictor variables
(adjusting for log(domGross), log(intgross) and log(intgross)* log(domGross).


While controlling for the variables in our model, the odds of passing the
Bechdel test for a movie that premiered in the 2000s is estimated to be 2.358008
times the odds of a film 
that was released in the 1970s (adjusting for the our transformed variables).

While controlling for the variables in our model, the odds of passing the
Bechdel test for a movie that premiered in the 2010s is estimated to be 2.004206
times the odds of a film 
that was released in the 1970s (adjusting for the our transformed variables).


There is sufficient evidence to suggest that the decade in which a movie
premiered in is associated with differential odds of the moving
passing the Bechdel test, while
controlling for all of the variables listed in the previous section.



Even though our result was significant, we also want to check for 
the predictive power of our model. We will thus check the obtain predicted
probabilities of success for our binary variable "passfail." We will impose
a threshold of 0.5 as our classifier. We will check the sensibility and
sensitivity for our model to asses its predictive power and construct an ROC
curve to show how specificity and specificity change as our
discrimination threshold changes. Calculating the area underneath the ROC curve
will also give us more insight into the predictive power of our model.









```{r how-many-movies2-passed-test-across-decades, message = F, warning = F, echo=FALSE}


m2_aug <- augment(m22)
m2_aug <- m2_aug %>%
mutate(prob = exp(.fitted)/(1 + exp(.fitted)), pred_leg = ifelse(prob >
0.5,
'Pass',
'Fail')) 
  
table(m2_aug$pred_leg, m2_aug$passfail) %>% 
  kable()



m2_aug %>% 
  roc_auc(
    truth = as.factor(passfail),
    prob, 
    event_level = "second"
  )


m2_aug %>% 
  roc_curve(
    truth = as.factor(passfail),
    prob, 
    event_level = "second"
  ) %>% 
  autoplot() 



 400 /( 400 + 394)  #sensitivity
 669 /( 669 + 313) # specificity


```

Our Area under the curve is 0.63 which is higher than 0.05--meaning 
that our model suggests some discrimination its outcomes are not completely
governed by chance.

To further evaluate the predictive power of our model, we also calculated
the sensitivity and specificity of our model. Our specificity was 68.3%.
Furthermore, our sensitivity was 49.%.

## Discussion ##

In this section you’ll include a summary of what you have learned about
your research question along with statistical arguments supporting your 
conclusions. In addition, discuss the limitations of your analysis and
provide suggestions on ways the analysis could be improved. Any potential
issues pertaining to the reliability and validity of your data and
appropriateness of the statistical analysis should also be discussed 
here. Lastly, this section will include ideas for future work.

Ultimately, our model demonstrates that there is an association between
the decade in which a film was released and whether it passes or fails the
Bechdel test. We observed this through our hypothesis test which demonstrated
that movies that came out in the 2000s and 2010s were more likely to pass the Bechdel
rather than movies that came out in the 1970s. The logic behind this conclusion
in the summary statistics of our data (48% of the films that premiered 
in the 2000s passed the Bechdel and  % of the movies that came out in the 
2010s passed the test while 25% of the films that premiered 
in the 1970s passed the Bechdel test). 

We can conclude, therefore, that the time period in which a movie 
came out in does in fact hold predictive power in predicting whether the given film passed or failed the Bechdel test. Perhaps the movie industry has indeed progressed throughout time and has released films with more adequate female representation in film. This could be a result of the recent diversity campaigns in Hollywood and a result of an increase of women workinh in the film industry, allowing for more adequate representationf for female characters. Therefore, we can conclude that it is more likely for a film that premiered in the 2000s to pass the Bechdel test than a film that premiered in the 1970s. We did not see the case that movies that came out in the 2010s were more likely to pass the Bechdel test than movies that premiered in the 1970s. However, thus could be more due to the fact that our data set only contained values from 2010-2013. Perhaps, if we conducted this same analysis with a new data set that included films frmo 2010-2019, we could see a more similar result to the case with the 2000s.


However, the predictive power of our model was, overall, pretty weak.
Our model only detected 50% of the films that in actuality passed the 
Bechdel test as shown by our sensitivity calculation. Our model did a 
slight better job at predicting which movies failed the Bechdel
test as shown by the fact that our model predicted 68% of films that
in actuality failed the Bechdel test. Usually, a really good
predictive model would have a combined score. This is further 
demonstrated 
by the fact that our AUC was 0.626768	which means that our test performed 
slightly better
than a test that would predict whether a given film passed or failed the
Bechtel test completely by chance. Usually a AUC score of 0.7-0.8 is
needed to show acceptable discrimination.
(Medley, 2010).

Our model most likely did not obtain enough predictive power
because of the limitations our investigation faced. Firstly,
our model had an uneven amount of films that premiered in our decades
of interest. We had 54 observations for the 1970s, 125 observations for
1980s, 337 for 1990s, 840 for the 2000s and 438 for the 2010s (see Appendix 
for summary stats). This could have in turn affected our statistical inference 
since there was in balance of obervations for eahc level of our predictor 
variable. Another limitation is the fact some of the coefficients
in our model
are pretty difficult to interpret. This can be seen with our transformed 
variable of domestic gross. If anyone wanted to use to inteprtret thhis 
speicific coefficinet from our model, the interpretation would be pretty 
lackluster. Lastly, another limitation includes the lack of variables
in our data set. Our data set only included 15 variables to begin with
which have us a limited amount of variables to choose from. 



There are many future directions that could be taken with this investigation.
For starters, it could be interetsing to have a dataset that represents more
decades (from the 1920s till 2020s). Furthermore, future investigations
should include more variables in their model. It could be interesting
to see if the number of women working on the film is associated with
the film's score on the Bechdel tets. The film genre could also be an
interetsing variable to look at; it is possible that movies from 
certain genres are predicted to have higher odds of passing 
the Bechdel test than others. 







## Sources

https://socialsciences.ucla.edu/wp-content/uploads/2022/03/UCLA-Hollywood-Diversity-Report-2022-Film-3-24-2022.pdf

https://www.nytimes.com/2017/02/21/movies/women-protagonists-movies-2016.html
https://www.tandfonline.com/doi/pdf/10.1080/14680777.2016.1234239?needAccess=true

https://bechdeltest.com/

https://www.sciencedirect.com/science/article/pii/S1556086415306043#:~:text=In%20general%2C%20an%20AUC%20of,than%200.9%20is%20considered%20outstanding.

https://fivethirtyeight.com/features/the-dollar-and-cents-case-against-hollywoods-exclusion-of-women/

https://ew.com/oscars/2017/07/03/oscars-2017-new-members-diversity-push/


## Appendix ##

```{r how-many-movies-passed-test-across-decades22, message = F, warning = F, echo= FALSE}


  
  ggplot(data= movies_decades, mapping= aes(x= binary, y= dom_Gross2013)) +
  geom_boxplot() %>% 
  




```



